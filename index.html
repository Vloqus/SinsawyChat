<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Sinsawy Chat v3.0</title>
  <style>
    :root {
      --bg: #111; --text:#eee; --prim:#00ffaa; --sec:#222; --accent:#2d2d2d; --admin:#ff5f5f;
    }
    *{box-sizing:border-box;}
    body{margin:0;font-family:Segoe UI,sans-serif; background:var(--bg); color:var(--text);
      display:flex; flex-direction:column; align-items:center; min-height:100vh;}
    h1{margin:1rem 0;color:var(--prim); font-size:2.4rem;}
    .card{width:100%; max-width:720px; background:var(--sec); border-radius:10px; padding:1rem;
          box-shadow:0 0 12px rgba(0,255,170,0.2); margin:1rem;}
    input, button{padding:.8rem; font-size:1rem; border:none; border-radius:8px; margin:.3rem 0;}
    input{width:100%; background:#333; color:#eee;}
    button{background:var(--prim); color:black; cursor:pointer; font-weight:bold; transition:0.3s;}
    button:hover{background:#00dd88;}
    #chatBox{background:var(--accent); border-radius:10px; padding:1rem; max-height:350px; overflow-y:auto; margin-bottom:1rem;}
    .message{display:flex; align-items:center; justify-content:space-between; background:#1d1d1d;
        border-left:3px solid var(--prim); border-radius:6px; margin:.5rem 0; padding:.6rem;}
    .msg-content{flex-grow:1;}
    .admin-btn{background:var(--admin); color:white; padding:.2rem .6rem; border-radius:4px; cursor:pointer; margin-left:.5rem;}
    .reactions{margin-top:.4rem;}
    .reaction{cursor:pointer; padding:0 .3rem; font-size:0.9rem;}
    .status{font-size:.9rem;color:#bbb;margin-bottom:.3rem;}
    .typing{font-style:italic;color:#888;}
    #onlinePanel{display:none; background:var(--accent); padding:1rem;border-radius:8px; max-height:180px; overflow-y:auto; margin-top:1rem;}
  </style>
</head>
<body>
  <h1>Sinsawy Chat</h1><div id="version">v3.0</div>
  
  <div id="loginDiv" class="card">
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div id="chatDiv" class="card" style="display:none">
    <div class="status">
      <span id="onlineUsers">Online: â€¦</span>
      <span id="typingIndicator" class="typing"></span>
    </div>
    <div id="chatBox"></div>
    <input id="msgInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendMessage()">
    <button onclick="sendMessage()">Send</button>
    <div style="margin-top:1rem">
      <button onclick="startRecording()">ðŸŽ™ Record</button>
      <button onclick="stopRecording()">ðŸ›‘ Stop</button>
      <button onclick="playRecording()">â–¶ Play</button>
      <button onclick="sendVoice()">ðŸ“¤ Send Voice</button>
      <div id="recStatus"></div>
    </div>
    <div class="status">
      <input type="file" id="fileInput"><button onclick="sendFile()">Upload</button>
    </div>
    <button onclick="toggleOnlinePanel()">Show Online Users</button>
    <div id="onlinePanel"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
  const fbCfg = {
    apiKey:"AIzaSyB9ML...", authDomain:"sinsawy-b3ab7.firebaseapp.com",
    databaseURL:"https://sinsawy-b3ab7-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:"sinsawy-b3ab7", storageBucket:"sinsawy-b3ab7.appspot.com",
    messagingSenderId:"160986446082", appId:"1:160986446082:web:..."}
  firebase.initializeApp(fbCfg);
  const db = firebase.database();

  const users = { omar:'omarsucksdick69', chicken:'pass', shady:'pass', yehia:'pass', seif:'pass', negro:'pass', aram:'pass', jan:'supercooldude69'};
  let currentUser = '', mediaRec, audioBlob;

  function login(){
    const u=document.getElementById('username').value.toLowerCase();
    const p=document.getElementById('password').value;
    if(users[u] && users[u]===p){
      currentUser=u;
      document.getElementById('loginDiv').style.display='none';
      document.getElementById('chatDiv').style.display='block';
      db.ref('typing/'+u).remove();
      db.ref('online/'+u).set(true);
      db.ref('online/'+u).onDisconnect().remove();
      listenMessages(); listenOnline(); setupTyping();
    } else alert('Wrong login');
  }

  function listenMessages(){
    db.ref('messages').on('value',snap=>{
      document.getElementById('chatBox').innerHTML='';
      snap.forEach(ch=>{
        const m=ch.val(), time=new Date(m.timestamp||0).toLocaleTimeString();
        const div=document.createElement('div'); div.className='message';
        let content=`<div class="msg-content"><b>${m.user}:</b> ${m.text||''}`;
        if(m.file){
          if(m.file.match(/\.(jpe?g|png|gif|webp)$/i))
            content+=`<br><img src="${m.file}" style="max-width:200px;border-radius:6px;margin:.4rem 0">`;
          else if(m.file.endsWith('.webm')||m.file.endsWith('.mp3'))
            content+=`<br><a href="${m.file}" target="_blank">[Media File]</a>`;
          else content+=`<br><a href="${m.file}" target="_blank">[File]</a>`;
        }
        content+=` <span style="color:#aaa;font-size:.8rem">(${time})</span>`;
        content+=`</div>`;
        div.innerHTML=content;
        const reactions=['ðŸ‘','ðŸ˜‚','ðŸ’€'];
        const reactionBar=document.createElement('div'); reactionBar.className='reactions';
        reactions.forEach(r=>{
          const span=document.createElement('span'); span.innerText=r; span.className='reaction';
          span.onclick=()=>db.ref(`reactions/${ch.key}/${currentUser}`).set(r);
          reactionBar.appendChild(span);
        });
        db.ref(`reactions/${ch.key}`).on('value',rs=>{
          const vals=rs.val()||{};
          reactionBar.title=Object.values(vals).join(' ');
        });
        div.appendChild(reactionBar);

        if(currentUser==='jan'){
          const ipBtn=document.createElement('button');
          ipBtn.innerText='ðŸ‘ IP'; ipBtn.className='admin-btn';
          ipBtn.onclick=()=>alert(m.ip||'N/A');
          div.appendChild(ipBtn);
        }
        document.getElementById('chatBox').appendChild(div);
      });
      document.getElementById('chatBox').scrollTop=document.getElementById('chatBox').scrollHeight;
    });
  }

  function sendMessage(){
    const txt=document.getElementById('msgInput').value.trim(); if(!txt) return;
    let out=txt;
    const cmd=txt.split(' ')[0].toLowerCase();
    const cmdMap={'/roll':()=>`ðŸŽ² rolled ${Math.ceil(Math.random()*6)}`, '/8ball':()=>{
        const arr=['Yes','No','Maybe','Hell nah','Sure','Ask later']; return `ðŸŽ± ${arr[Math.floor(Math.random()*arr.length)]}`;
    }, '/truth':()=>`Truth: what's your biggest fear?`, '/dare':()=>`Dare: Say "I love coding"`,'/roast':()=>`Roast: you code like my grandma ðŸ« `};
    if(cmdMap[cmd]) out=cmdMap[cmd]();
    db.ref('messages').push({user:currentUser, text:out, timestamp:Date.now(), ip:undefined});
    document.getElementById('msgInput').value=''; db.ref('typing/'+currentUser).remove();
  }

  // reactions done inline
  function sendFile(){
    const f=document.getElementById('fileInput').files[0]; if(!f) return alert('No file');
    const wrk="https://discord.com/api/webhooks/1399006537564950610/8F12Ca7YztHMKexeT47e2M2ieLxi3hF4lSZixbTqVDwWL3sKXpXN5SnK00-aFszGQm1y";
    const fd=new FormData(); fd.append('file',f); fd.append('content',`${currentUser} sent file`);
    fetch(wrk,{method:'POST',body:fd})
      .then(r=>r.ok? r.json():Promise.reject('wh fail'))
      .then(d=>{
         const url=d.attachments?.[0]?.url;
         db.ref('messages').push({user:currentUser,file:url, timestamp:Date.now(), text:'[File]', ip:undefined});
         document.getElementById('fileInput').value='';
      }).catch(e=>{console.error(e);alert('Upload fail')});
  }

  function setupTyping(){
    const inp=document.getElementById('msgInput');
    inp.addEventListener('input',()=>{
      db.ref('typing/'+currentUser).set(true);
      setTimeout(()=>db.ref('typing/'+currentUser).remove(),2000);
    });
    db.ref('typing').on('value',sn=>{
      const keys=Object.keys(sn.val()||{}).filter(x=>x!==currentUser);
      document.getElementById('typingIndicator').innerText=keys.length?`${keys.join(', ')} typing...`:'';
    });
  }
  function listenOnline(){
    db.ref('online').on('value',sn=>{
      const us=Object.keys(sn.val()||{}); document.getElementById('onlineUsers').innerText='Online: '+us.join(', ');
      document.getElementById('onlinePanel').innerHTML='<ul>'+us.map(u=>`<li>${u}</li>`).join('')+'</ul>';
    });
  }
  function toggleOnlinePanel(){const p=document.getElementById('onlinePanel');p.style.display=p.style.display==='none'?'block':'none';}

  // voice recording
  function startRecording(){
    navigator.mediaDevices.getUserMedia({audio:true}).then(s=>{
      mediaRec=new MediaRecorder(s);
      mediaRec.ondataavailable=e=>audioBlob=e.data;
      mediaRec.start(); document.getElementById('recStatus').innerText='Recordingâ€¦';
    });
  }
  function stopRecording(){mediaRec&&mediaRec.stop(); document.getElementById('recStatus').innerText='Stopped';}
  function playRecording(){if(!audioBlob)return; const url = URL.createObjectURL(audioBlob); new Audio(url).play();}
  function sendVoice(){
    if(!audioBlob)return alert('No recording');
    const f=new File([audioBlob],'voice.webm',{type:'audio/webm'}); const fd=new FormData();
    fd.append('file',f); fd.append('content',`${currentUser} voice message`);
    fetch("https://discord.com/api/webhooks/1399006537564950610/8F12Ca7YztHMKexeT47e2M2ieLxi3hF4lSZixbTqVDwWL3sKXpXN5SnK00-aFszGQm1y",{method:'POST',body:fd})
    .then(r=>r.json()).then(d=>{
      const url=d.attachments?.[0]?.url; db.ref('messages').push({user:currentUser,file:url, text:'[Voice message]', timestamp:Date.now(), ip:undefined});
    }).catch(()=>alert('fail'));
  }
  </script>
</body>
</html>
